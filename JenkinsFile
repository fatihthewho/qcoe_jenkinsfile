#!/bin/groovy
try {
	node
	def te ="asd"
	{
		stage ('Setup') {
			helper = load "${env.WORKSPACE.split('@')[0]}@script/src/helpers.groovy"
		}
		node("selenium"){
			stage ('Checkout'){
				echo "===accessing Project repo  ==============="
				helper.checkoutRepo(params.repo_url,params.branch)
			}
			/* stage ('Build'){
				bat 'mvn clean compile'
			} */
			stage ('Test'){

			echo "===accessing Project reposs  ==============="
			/*try{
			 helper.executeMavenTests(params.no_of_parallel_threads, params.use_selenium_grid, params.browser, params.environment, params.no_of_retries, params.test_suite_file)
			 }
			 catch(Exception e){
			 currentBuild.result = 'FAILURE'
			 }*/

			}
			/* stage("Artifacts") {
				echo "=======Artifacts stage ===="
				helper.archiveJavaArtifacts();

			} */
			stage('XRay') {
				echo "=======XRay stage ===="
				EMAIL_INFO = helper.getFileContent("${env.WORKSPACE}/JenkinsInfo.txt");
				helper.updateXRayWithTestNG(params.test_plan_key);
			}
		}
		stage ('Email') {

			helper.sendEmail(params.email_recipients,"${EMAIL_INFO}");
		}

	}


} catch(Exception ex) {
	println(ex)
    currentBuild.result = 'FAILURE'
} finally {
	echo "===Done  ==============="
}
