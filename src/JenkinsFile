#!/bin/groovy
import groovy.io.FileType


try {
def helper
	node
	{
	cleanWs()
		stage ('Setup') {
		def list = []

        def dir = new File(".")
        dir.eachFileRecurse (FileType.FILES) { file ->
          list << file
        }
        list.each {
          println it.path
        }
		def files = findFiles(glob: '**/*.html')
		echo """${files[0].name} ${files[0].path} ${files[0].directory} ${files[0].length} ${files[0].lastModified}"""
		echo "${env.WORKSPACE}"
			helper = load 'helpers.groovy'
		}
		node("selenium"){
			stage ('Checkout'){
			echo "===params.email_recipients  ==============="
			    helper.prepareEmail()
				echo "===accessing Project repo  ==============="
				helper.checkoutRepo(params.repo_url,params.branch)
			}
			stage ('Build'){
				bat 'mvn clean compile'
			}
			stage ('Test'){
			echo "===accessing Project reposs  ==============="
                /*try{
                 helper.executeMavenTests(params.no_of_parallel_threads, params.use_selenium_grid, params.browser, params.environment, params.no_of_retries, params.test_suite_file)
                 }
                 catch(Exception e){
                 currentBuild.result = 'FAILURE'
                 }

                */
			}

			/* stage("Artifacts") {
				echo "=======Artifacts stage ===="
				helper.archiveJavaArtifacts();

			} */
			stage('XRay') {
				echo "=======XRay stage ===="
				EMAIL_INFO = helper.getFileContent("${env.WORKSPACE}/JenkinsInfo.txt")
				//helper.updateXRayWithTestNG(params.test_plan_key)
			}
		}
        stage ('Send Email') {

        }

	}


} catch(Exception ex) {
	println(ex)
    currentBuild.result = 'FAILURE'
} finally {
	echo "===Done  ==============="
}
